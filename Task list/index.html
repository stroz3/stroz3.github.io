<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="jquery-ui.css">
</head>

<body>
	<div class="" id="app">
		<header>
			<div class="header-full">
				<div class="Task_list">
					<a href="#"><img src="img/logo-task-list.png" alt=""></a>
				</div>
				<div class="calendar">
					<div id="calend">

						<p><input type="text" id="datepicker" class="input2" readonly=""></p>
					</div>
					<p id="clock"> 00:00</p>
				</div>
				<div class="logos">
					<a href="https://www.xe.com/" target="_blank"><img src="img/logo.png" alt=""></a>
				</div>

			</div>
			<div class="logout">
				<img src="img/logout.png" alt="">
			</div>
		</header>
		<div class="Task-full">
			<div class="wrapper">
				<div class="All-quest">
					<div class="quest-title">
						<h2>Все задачи</h2><img src="img/more.png" alt="">
					</div>
					<div class="add-quest"><img src="img/plus.png" alt="">
						<p @click="changeToDo">Создать новый список</p>
					</div>
					<div class="quest">
						<h2>Павел</h2>
						<ul class="quest-list">
							<todo-name :data-tab-name="'block_'+index" :class="'block_' + index"
								v-for="(item, index) in pending" :item="item" :key="item.name" :index="index">
							</todo-name>
						</ul>
					</div>
				</div>

				<div v-show='!create' class="quest-full full" v-for="(item, index) in pending"
					:class="'block_' + index">
					<todo-list :item="item" :pending="pending" :is-Active="isActive" :name="new_name" :show="show">
					</todo-list>
				</div>

				<div v-show="create" class="quest-full">
					<div class="quest-title">
						<div class="quest-title-text">
							<h2><input placeholder="Название вашего списка" v-model="new_name"></h2>
						</div>
					</div>
					<div class="ul-quest">
						<ul>
							<li v-for="(item,index) in new_todo">
								<input placeholder="Ваша задача" type=" text" v-model="new_todo[index]">
								<button @click="new_todo.push('')">+</button>
							</li>
						</ul>
					</div>
					<div class="save">
						<button @click="addItem">Создать</button>
					</div>
				</div>

				<div class="quest-create">
					<div class="button-save"><button>Ссылки и другое</button></div>
					<div class="new-quest">
						<div class="post"><img src="img/plus.png" alt="">
							<p>Добавить</p>
						</div>
						<div class="quest-input">
							<input type="text" placeholder="Название">
							<input type="text" placeholder="Ссылка">
							<button>Сохранить</button>
						</div>
						<div>
							<ul class="links">
								<li><img src="img/link.png" alt=""><a href="">Сайт Авито</a></li>
								<li><img src="img/link.png" alt=""><a href="">Сайт Михаила</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="login display-none">
			<div class="logo">
				<img src="img/logo-task-list.png" alt="">
			</div>
			<div class="input-login">
				<input type="text" placeholder="Login">
				<img src="img/profile.png" alt="">
			</div>
			<div class="input-login">
				<input type="text" placeholder="Password">
				<img src="img/pen.png" alt="">
			</div>
			<div class="button-login">
				<button>Войти</button>
			</div>
		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
	<script>
		Vue.component('todo-name', {
			props: {
				item: Object,
				index: Number
			},
			template: `
			<li class="quest-list-li"><img
				src="img/monthly.png" alt="">
				<p> {{ item.name }} </p>
			</li>
			`,
			methods: {
			}
		})
		Vue.component('todo-list', {
			props: ["pending", "item", "name", "index", "todoList"],
			template: `
				<div>
					<div class="quest-title">
						<div class="quest-title-text">
							<h2 v-if="!isActive"> {{ item.name }} </h2>
							<h2 v-else><input v-model="item.name"></h2>
						</div>
						<div @click="showNav" class="create-quest">
							<img src="img/more.png" alt="">
						</div>
					</div>
					<transition name="navCreate">
						<div v-if="show" class="nav-create">
							<p @click="changeToDo">Редактировать</p>
							</div>
					</transition>
					<div class="ul-quest">
						<ul>
							<li v-if="!isActive" v-for="(value, indexItem) in item.title">
								<span @click="finishTitle"  class="todo-text">{{ value }} </span>
								<li v-else>
									<input v-model="item.title[indexItem]">
									<button class="" @click="item.title.splice(indexItem, 1)" >x</button>
									</li>
									<button  v-show="isActive" class="last-button" @click="item.title.push('')" >+</button>
								</li>
						</ul>
					</div>
					<div class="save">
						<button @click="saveToDo">Сохранить</button>
					</div>	
				</div>
			`,
			data() {
				return {
					isActive: false,
					show: false,
					isDone: false,
				}
			},
			methods: {
				finishTitle(event) {
					event.target.classList.toggle('complete')
				},
				changeToDo(event) {
					this.show = false
					this.isActive = true

				},
				createTodo() {
					this.isActive = !this.isActive
				},

				saveToDo() {
					this.isActive = false
					this.addItem()
				},
				showNav() {
					this.show = !this.show
				},
				getTodos() {
					// get all todos when loading the page
					if (localStorage.getItem('todo_list')) {
						this.todoList = JSON.parse(localStorage.getItem('todo_list'));
					}
				},
				// add a new item
				addItem() {
					// validation check
					if (this.new_todo) {
						this.todoList.unshift({
							id: this.todoList.length,
							title: this.new_todo,
							name: this.new_name,
							done: false,
						});
					}
					// reset new_todo
					this.new_todo = '';
					// save the new item in localstorage
					return true;
				},
				deleteItem(index) {
					this.todoList.splice(this.todoList.indexOf(index), 1);
				},
				toggleShowComplete() {
					this.showComplete = !this.showComplete;
				},

			},
		})

		new Vue({
			el: '#app',
			data() {
				return {
					create: false,
					isActive: false,
					show: false,
					todoList: [
						{ "id": 0, "name": "Список заданий 1", "title": ["Сходить в магазин", "Выполнить дз", "Убраться в квартире"], "done": false },
						{ "id": 1, "name": "Список заданий 2", "title": ["Сходить на тренировку", "Выполнить дз", "Вытереть пыль"], "done": false },
						{ "id": 4, "name": "Список заданий 3", "title": ["Сделать модель"], "done": false }
					],
					new_todo: [''],
					new_name: '',
				}
			},
			mounted() {
				this.getTodos();
			},
			watch: {
				todoList: {
					handler: function (updatedList) {
						localStorage.setItem('todo_list', JSON.stringify(updatedList));
					},
					deep: true
				}
			},
			methods: {
				changeToDo(event) {
					this.show = false
					this.isActive = true
					this.create = !this.create
				},
				createTodo() {
					this.isActive = !this.isActive

				},
				saveToDo() {
					this.isActive = false
					this.addItem()
				},
				showNav() {
					this.show = !this.show
				},
				getTodos() {
					// get all todos when loading the page
					if (localStorage.getItem('todo_list')) {
						this.todoList = JSON.parse(localStorage.getItem('todo_list'));
					}
				},
				// add a new item
				addItem() {
					// validation check
					if (this.new_name || this.new_todo) {
						this.todoList.unshift({
							id: this.todoList.length,
							name: this.new_name,
							title: this.new_todo,
							done: false,
						});
					}
					// reset createTodo
					this.create = false
					// reset new_todo
					this.new_name = '';
					this.new_todo = ['Ваша задача'];
					// save the new item in localstorage
					return true;
				},
				// addTask() {
				// 	this.title = this.title.push('');
				// },
				deleteItem(item) {
					this.todoList.splice(this.todoList.indexOf(item), 1);
				},
				toggleShowComplete() {
					this.showComplete = !this.showComplete;
				},
				// addTask(){
				// 	if()
				// 	this.new_todo.push('')
				// }
			},
			computed: {
				pending: function () {
					return this.todoList.filter(function (item) {
						return !item.done;
					})
				},
				completed: function () {
					return this.todoList.filter(function (item) {
						return item.done;
					});
				},
				completedPercentage: function () {
					return (Math.floor((this.completed.length / this.todoList.length) * 100)) + "%";
				},
			},
		})
	</script>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script src="script.js"></script>
	<script>
		$(function () {
			$("#datepicker").datepicker();
			$("#ui-datepicker-div").css({ "top": "70px" })
		});
		$("#datepicker").datepicker({
			dateFormat: ""
		});
	</script>
</body>

</html>